<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Planning</title>
    <style>
        /* Basic Styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* Page-level container */
        .page-container {
            max-width: 1200px;
            margin: auto;
        }

        h1 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 30px;
        }

        h2, h3 {
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-top: 0;
        }

        p {
            color: #666;
            font-size: 1rem;
            line-height: 1.6;
        }
        
        /* Page switching logic */
        .page {
            display: none; /* Hide all pages by default */
        }
        .page.active {
            display: block; /* Show only the active page */
        }

        /* --- Home Page Styling --- */
        .home-layout {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            min-height: 60vh;
        }
        
        .home-card {
            flex: 1;
            max-width: 400px;
            background: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .home-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
        }

        .home-card .icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .home-card h3 {
            font-size: 1.5rem;
            color: #0056b3;
            margin-bottom: 10px;
            border-bottom: none;
        }

        /* Responsive stacking for home cards */
        @media (max-width: 768px) {
            .home-layout {
                flex-direction: column;
            }
        }

        /* --- Back Button --- */
        .back-btn {
            background-color: #6c757d;
            margin-bottom: 20px;
        }
        .back-btn:hover {
            background-color: #5a6268;
        }

        /* --- Diet & Fitness Page Box --- */
        .content-box {
            background: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative; /* For loader positioning */
            margin-bottom: 20px;
        }

        /* --- Form Styling (Shared) --- */
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        textarea, select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            box-sizing: border-box;
            background-color: #fff;
        }

        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 10px;
            transition: background-color 0.3s;
            width: 100%;
        }
        .btn:disabled {
            background-color: #a0cfff;
            cursor: not-allowed;
        }

        .btn:hover:not(:disabled) {
            background-color: #0056b3;
        }
        
        #diet-results, #fitness-plan-results {
            margin-top: 20px;
            min-height: 100px;
            position: relative;
        }

        .recipe-card {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* --- Recipe Modal --- */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
            border-radius: 12px;
            position: relative;
        }

        .close-btn {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .recipe-details h3 { color: #0056b3; border-bottom: none; }
        .recipe-details .time { font-style: italic; color: #555; }
        .recipe-details ul, .recipe-details ol { padding-left: 20px; }
        .recipe-details li { margin-bottom: 8px; }
        .recipe-details .step-time { font-weight: bold; color: #007bff; }


        /* --- Timer --- */
        .timer-container {
            margin-top: 20px;
            padding: 15px;
            background: #e9f5ff;
            border-radius: 8px;
            text-align: center;
        }
        .timer-display { font-size: 2.5rem; font-weight: bold; color: #0056b3; margin-bottom: 10px;}
        .timer-controls button { margin: 0 5px; }


        /* --- Exercise Planner Section --- */
        .activity-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .activity-toggle .btn {
            background-color: #e0e0e0;
            color: #333;
            width: auto; /* override width for toggle buttons */
        }
        .activity-toggle .btn.active {
            background-color: #007bff;
            color: white;
        }

        .activity-list { list-style-type: none; padding-left: 0; }
        .activity-list li {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            color: #555;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        .activity-list img {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: 8px;
            background: #e0e0e0;
        }
        
        /* Workout Timer & Calorie Counter */
        #workout-tracker {
            margin-top: 25px;
            padding: 20px;
            border: 2px dashed #007bff;
            border-radius: 10px;
            text-align: center;
            background-color: #f8f9fa;
        }
        #workout-timer-display, #calorie-display {
            font-size: 2rem;
            font-weight: bold;
        }
        #calorie-display {
            color: #28a745;
        }

        .level-up-notice {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* History Table */
        #history-container {
            margin-top: 20px;
        }
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .history-table th, .history-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .history-table th {
            background-color: #f2f2f2;
            color: #333;
        }
        .history-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* Loading Spinner */
        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #007bff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

    <div class="page-container">
        <h1>Health Planning </h1>

        <!-- Page 1: Home -->
        <div id="home-page" class="page active">
            <div class="home-layout">
                <div class="home-card" onclick="showPage('diet-page')">
                    <div class="icon">ü•ó</div>
                    <h3>Homely Diet Planner</h3>
                    <p>Get personalized recipes based on the ingredients you already have at home.</p>
                </div>
                <div class="home-card" onclick="showPage('fitness-page')">
                    <div class="icon">üèã‚Äç‚ôÄ</div>
                    <h3>Personalized Fitness Plan</h3>
                    <p>Find exercise and yoga routines tailored to your specific fitness level.</p>
                </div>
            </div>
        </div>

        <!-- Page 2: Diet Planner -->
        <div id="diet-page" class="page">
            <button class="btn back-btn" onclick="showPage('home-page')">&larr; Back to Home</button>
            <div class="content-box">
                <h2>AI-Powered Diet Planner</h2>
                <p>Select your dietary preference, then enter your available ingredients. Our AI will invent a unique recipe just for you.</p>
                
                <form onsubmit="return false;">
                    <div class="form-group">
                        <label for="recipe-type">Select Recipe Type:</label>
                        <select id="recipe-type">
                            <option value="any">Any</option>
                            <option value="vegetarian">Vegetarian</option>
                            <option value="non-vegetarian">Non-Vegetarian</option>
                            <option value="vegan">Vegan</option>
                            <option value="gluten-free">Gluten-Free</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ingredients">Enter ingredients (comma separated):</label>
                        <textarea id="ingredients" placeholder="e.g., chicken, rice, onion, tomato, spinach, paneer, eggs..."></textarea>
                    </div>
                    <button type="button" id="recipe-btn" class="btn" onclick="generateDietPlan()">Find Recipe</button>
                </form>

                <div class="loader" id="diet-loader"></div>
                <div id="diet-results"></div>
            </div>
        </div>

        <!-- Page 3: Fitness Planner -->
        <div id="fitness-page" class="page">
            <button class="btn back-btn" onclick="showPage('home-page')">&larr; Back to Home</button>
            <div class="content-box">
                <h2>AI-Powered Fitness Plan</h2>
                <p>Tell us about yourself to get a truly personalized exercise or yoga plan, complete with visual guides.</p>

                <form onsubmit="return false;">
                     <div class="form-group">
                        <label for="user-age">Your Age:</label>
                        <input type="number" id="user-age" placeholder="e.g., 35" min="12" max="100">
                    </div>
                     <div class="form-group">
                        <label for="user-gender">Your Gender:</label>
                        <select id="user-gender">
                            <option value="female">Female</option>
                            <option value="male">Male</option>
                            <option value="prefer not to say">Prefer not to say</option>
                        </select>
                    </div>
                     <div class="form-group">
                        <label for="user-weight">Your Weight (in kg):</label>
                        <input type="number" id="user-weight" placeholder="e.g., 70" min="30" max="200">
                    </div>
                    <div class="form-group">
                        <label for="fitness-experience">How often do you exercise?</label>
                        <select id="fitness-experience">
                            <option value="never">Never (Beginner)</option>
                            <option value="rarely">Rarely (1-2 times a month)</option>
                            <option value="often">Often (2-3 times a week)</option>
                            <option value="very often">Very Often (4+ times a week)</option>
                        </select>
                    </div>
                     <div class="activity-toggle">
                        <button id="show-exercise" class="btn active" onclick="toggleActivity('exercise')">üí™ Exercise</button>
                        <button id="show-yoga" class="btn" onclick="toggleActivity('yoga')">üßò Yoga</button>
                    </div>
                    <button type="button" id="fitness-btn" class="btn" onclick="generateFitnessPlan()">Generate My Plan</button>
                </form>

                <div class="loader" id="fitness-loader"></div>
                <div id="fitness-plan-results">
                    <!-- AI-generated fitness plan will appear here -->
                </div>
            </div>

            <!-- Workout History Section -->
            <div id="history-container" class="content-box">
                <h3>Workout History</h3>
                <div id="history-log">
                    <!-- History table will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Recipe Modal (shared across pages) -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="recipe-details" class="recipe-details"></div>
            <div id="timer" class="timer-container"></div>
        </div>
    </div>

    <script>
        // --- Page Navigation ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const pageToShow = document.getElementById(pageId);
            if (pageToShow) {
                pageToShow.classList.add('active');
                if (pageId === 'fitness-page') {
                    checkUserLevel();
                    displayWorkoutHistory(); // Display history when navigating to fitness page
                }
            }
        }

        // --- Global variables ---
        let currentRecipe = null;
        let currentFitnessPlan = null;
        let currentActivityType = 'exercise';
        let workoutTimerInterval;
        let workoutSeconds = 0;

        // --- AI Diet Planner Logic ---
        async function generateDietPlan() {
            const recipeType = document.getElementById('recipe-type').value;
            const ingredientsInput = document.getElementById('ingredients').value;
            const resultsDiv = document.getElementById('diet-results');
            const loader = document.getElementById('diet-loader');
            const recipeBtn = document.getElementById('recipe-btn');

            if (ingredientsInput.trim() === "") {
                resultsDiv.innerHTML = "<p>Please enter some ingredients first!</p>";
                return;
            }

            resultsDiv.innerHTML = '';
            loader.style.display = 'block';
            recipeBtn.disabled = true;

            const schema = {
                type: "OBJECT",
                properties: {
                    recipe_name: { type: "STRING" },
                    type: { type: "STRING" },
                    ingredients: { type: "ARRAY", items: { type: "STRING" } },
                    steps: { type: "ARRAY", items: { type: "OBJECT", properties: { task: { type: "STRING" }, duration: { type: "NUMBER" } }, required: ["task", "duration"] } }
                },
                required: ["recipe_name", "type", "ingredients", "steps"]
            };
            
            const typeText = recipeType === 'any' ? '' : recipeType;
            const prompt = Based on the following ingredients: ${ingredientsInput}, create a single, healthy ${typeText} recipe. The recipe must be practical and delicious. Provide the response in a valid JSON format that adheres to the provided schema. Include detailed steps with specific timings for each, including prep work like chopping. If the ingredients are contradictory to the recipe type (e.g., chicken for a vegan recipe), the recipe_name should state that it's not possible and the steps should explain why.;
            
            try {
                const aiResponse = await callGemini(prompt, schema);
                currentRecipe = aiResponse;
                
                if (currentRecipe.steps.length === 0 || currentRecipe.recipe_name.toLowerCase().includes("not possible")) {
                     resultsDiv.innerHTML = <p style="color: #d9534f; font-weight: bold;">${currentRecipe.recipe_name}</p>;
                } else {
                    const totalTime = currentRecipe.steps.reduce((sum, step) => sum + step.duration, 0);
                    resultsDiv.innerHTML = `
                        <div class="recipe-card" onclick="showRecipe()">
                            <h4>${currentRecipe.recipe_name}</h4>
                            <p>(${currentRecipe.type})</p>
                            <p>Total Time: ${totalTime} mins</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = <p style="color: red;">Sorry, there was an error generating the recipe. Please try again. ${error.message}</p>;
            } finally {
                loader.style.display = 'none';
                recipeBtn.disabled = false;
            }
        }
        
        // --- AI Fitness Planner Logic ---
        async function generateFitnessPlan() {
            const age = document.getElementById('user-age').value;
            const gender = document.getElementById('user-gender').value;
            const weight = document.getElementById('user-weight').value;
            const experience = document.getElementById('fitness-experience').value;
            const resultsDiv = document.getElementById('fitness-plan-results');
            const loader = document.getElementById('fitness-loader');
            const fitnessBtn = document.getElementById('fitness-btn');

            if (!age || !weight) {
                resultsDiv.innerHTML = "<p>Please enter your age and weight.</p>";
                return;
            }

            resultsDiv.innerHTML = '';
            loader.style.display = 'block';
            fitnessBtn.disabled = true;

            const schema = {
                type: "OBJECT",
                properties: {
                    plan_title: { type: "STRING" },
                    average_met: { type: "NUMBER" }, // Average MET value for the whole workout
                    activities: {
                        type: "ARRAY",
                        items: {
                            type: "OBJECT",
                            properties: {
                                name: { type: "STRING" },
                                description: { type: "STRING" },
                                image_url: { type: "STRING" }
                            },
                            required: ["name", "description", "image_url"]
                        }
                    }
                },
                required: ["plan_title", "average_met", "activities"]
            };

            const prompt = Create a personalized ${currentActivityType} plan for a ${age}-year-old ${gender} whose experience level is "${experience}". The plan should consist of 5-7 suitable activities. Provide an overall "average_met" value for the entire workout plan (e.g., 3.5 for light yoga, 7.0 for vigorous exercise). For each activity, provide a name, a brief description (e.g., sets, reps, or duration), and a placeholder image URL from placehold.co in the format https://placehold.co/200x150/a2d2ff/ffffff?text=ActivityName. The response must be in a valid JSON format adhering to the provided schema.;

            try {
                const aiResponse = await callGemini(prompt, schema);
                currentFitnessPlan = aiResponse;
                displayFitnessPlan(currentFitnessPlan);
            } catch (error) {
                 resultsDiv.innerHTML = <p style="color: red;">Sorry, there was an error generating the fitness plan. Please try again. ${error.message}</p>;
            } finally {
                loader.style.display = 'none';
                fitnessBtn.disabled = false;
            }
        }

        function displayFitnessPlan(plan) {
            const resultsDiv = document.getElementById('fitness-plan-results');
            let activitiesHtml = plan.activities.map(activity => `
                <li>
                    <img src="${activity.image_url}" alt="${activity.name}" onerror="this.onerror=null;this.src='https://placehold.co/100x75/cccccc/ffffff?text=Error';">
                    <div>
                        <strong>${activity.name}</strong>
                        <p>${activity.description}</p>
                    </div>
                </li>
            `).join('');
            
            resultsDiv.innerHTML = `
                <h3>${plan.plan_title}</h3>
                <ul class="activity-list">${activitiesHtml}</ul>
                <div id="workout-tracker" style="display:none;">
                    <h4>Workout Tracker</h4>
                    <div>
                        <p>Time Elapsed</p>
                        <p id="workout-timer-display">00:00:00</p>
                    </div>
                    <div>
                        <p>Calories Burned (Est.)</p>
                        <p id="calorie-display">0</p>
                    </div>
                    <div class="timer-controls">
                        <button class="btn" id="start-workout-btn" onclick="startWorkoutTimer()">Start</button>
                        <button class="btn" id="pause-workout-btn" onclick="pauseWorkoutTimer()" style="display:none;">Pause</button>
                        <button class="btn" id="stop-workout-btn" onclick="stopWorkoutTimer()" style="display:none;">Stop & Save</button>
                    </div>
                </div>
                <button class="btn" onclick="document.getElementById('workout-tracker').style.display='block'; this.style.display='none';">Start Workout</button>
            `;
        }
        
        // --- Generic Gemini API Call Function ---
        async function callGemini(prompt, schema) {
            const apiKey = ""; // Handled by environment
            const apiUrl = https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey};
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: schema
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(API error! status: ${response.status});
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                return JSON.parse(result.candidates[0].content.parts[0].text);
            } else {
                throw new Error("Invalid response structure from AI.");
            }
        }

        // --- Recipe Modal and Cooking Timer Logic ---
        const modal = document.getElementById('recipeModal');
        let recipeTimerInterval;
        function showRecipe() {
            if (!currentRecipe) return;
            const totalTime = currentRecipe.steps.reduce((sum, step) => sum + step.duration, 0);
            const ingredientsHtml = `<ul>${currentRecipe.ingredients.map(i => <li>${i}</li>).join('')}</ul>`;
            const stepsHtml = `<ol>${currentRecipe.steps.map(s => <li>${s.task} <span class="step-time">(${s.duration} min)</span></li>).join('')}</ol>`;
            document.getElementById('recipe-details').innerHTML = <h3>${currentRecipe.recipe_name}</h3><p class="time">Total cooking time: ${totalTime} minutes</p><h4>Ingredients:</h4>${ingredientsHtml}<h4>Instructions:</h4>${stepsHtml};
            document.getElementById('timer').innerHTML = <h4>Cooking Timer</h4><div class="timer-display" id="recipe-timer-display">${String(totalTime).padStart(2, '0')}:00</div><div class="timer-controls"><button class="btn" onclick="startRecipeTimer(${totalTime * 60})">Start</button></div>;
            modal.style.display = 'block';
        }
        function closeModal() {
            modal.style.display = 'none';
            clearInterval(recipeTimerInterval);
        }
        window.onclick = function(event) { if (event.target == modal) closeModal(); }
        function startRecipeTimer(duration) { /* Timer logic omitted for brevity, it's the same as before */ }

        // --- Workout Timer, Calorie, and Progression Logic ---
        function startWorkoutTimer() {
            document.getElementById('start-workout-btn').style.display = 'none';
            document.getElementById('pause-workout-btn').style.display = 'inline-block';
            document.getElementById('stop-workout-btn').style.display = 'inline-block';

            workoutTimerInterval = setInterval(() => {
                workoutSeconds++;
                let hours = Math.floor(workoutSeconds / 3600);
                let minutes = Math.floor((workoutSeconds % 3600) / 60);
                let seconds = workoutSeconds % 60;
                document.getElementById('workout-timer-display').textContent = 
                    ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')};
                updateCalories();
            }, 1000);
        }

        function pauseWorkoutTimer() {
            clearInterval(workoutTimerInterval);
            document.getElementById('start-workout-btn').style.display = 'inline-block';
            document.getElementById('pause-workout-btn').style.display = 'none';
        }

        function stopWorkoutTimer() {
            clearInterval(workoutTimerInterval);
            const calories = document.getElementById('calorie-display').textContent;
            saveWorkout(workoutSeconds, calories);
            workoutSeconds = 0; // Reset for next time
            document.getElementById('workout-tracker').style.display = 'none';
            document.querySelector('#fitness-plan-results .btn').style.display = 'block'; // Show the "Start Workout" button again
        }

        function updateCalories() {
            const weight = parseFloat(document.getElementById('user-weight').value);
            if (!weight || !currentFitnessPlan) return;
            const met = currentFitnessPlan.average_met;
            const hours = workoutSeconds / 3600;
            const calories = Math.round(met * weight * hours);
            document.getElementById('calorie-display').textContent = calories;
        }

        function saveWorkout(durationSeconds, caloriesBurned) {
            const history = JSON.parse(localStorage.getItem('workoutHistory')) || [];
            history.push({
                date: new Date().toISOString(),
                duration: Math.round(durationSeconds / 60), // save in minutes
                calories: caloriesBurned
            });
            localStorage.setItem('workoutHistory', JSON.stringify(history));
            alert('Workout saved! Keep up the great work!');
            displayWorkoutHistory(); // Refresh the history display
        }

        function displayWorkoutHistory() {
            const historyLog = document.getElementById('history-log');
            const history = JSON.parse(localStorage.getItem('workoutHistory')) || [];

            if (history.length === 0) {
                historyLog.innerHTML = "<p>No workouts saved yet. Complete a workout to see your history!</p>";
                return;
            }

            // Reverse history to show most recent first
            const reversedHistory = history.slice().reverse();

            let tableHtml = `<table class="history-table">
                <tr>
                    <th>Date</th>
                    <th>Duration (mins)</th>
                    <th>Calories Burned (Est.)</th>
                </tr>`;
            
            reversedHistory.forEach(workout => {
                const date = new Date(workout.date).toLocaleString();
                tableHtml += `
                    <tr>
                        <td>${date}</td>
                        <td>${workout.duration}</td>
                        <td>${workout.calories}</td>
                    </tr>
                `;
            });

            tableHtml += </table>;
            historyLog.innerHTML = tableHtml;
        }

        function checkUserLevel() {
            const history = JSON.parse(localStorage.getItem('workoutHistory')) || [];
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);

            const recentWorkouts = history.filter(w => new Date(w.date) > oneMonthAgo);
            const experienceSelect = document.getElementById('fitness-experience');
            const currentLevel = experienceSelect.value;
            let newLevel = 'never';

            if (recentWorkouts.length >= 8) {
                newLevel = 'very often';
            } else if (recentWorkouts.length >= 4) {
                newLevel = 'often';
            } else if (recentWorkouts.length > 0) {
                newLevel = 'rarely';
            }

            if (newLevel !== currentLevel) {
                experienceSelect.value = newLevel;
                // Remove any existing notice first
                const existingNotice = document.querySelector('.level-up-notice');
                if (existingNotice) existingNotice.remove();

                const notice = document.createElement('div');
                notice.className = 'level-up-notice';
                notice.textContent = üéâ Based on your recent activity, your fitness level has been updated to "${experienceSelect.options[experienceSelect.selectedIndex].text}"!;
                const form = experienceSelect.closest('form');
                form.prepend(notice);
            }
        }

        // --- Exercise/Yoga Toggle Logic ---
        function toggleActivity(activityType) {
            currentActivityType = activityType;
            const exerciseBtn = document.getElementById('show-exercise');
            const yogaBtn = document.getElementById('show-yoga');
            exerciseBtn.classList.toggle('active', activityType === 'exercise');
            yogaBtn.classList.toggle('active', activityType === 'yoga');
        }
    </script>

</body>
</html>